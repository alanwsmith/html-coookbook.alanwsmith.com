<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Autocomplete Selection Menu - The HTML, CSS, and JavaScript Cookbook Of Alan</title>
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Autocomplete Selection Menu" />
    <meta property="og:description" content="An selection menu with autocompletion that only allows for the configure values to be selected" />
    <meta
      property="og:image"
      content="https://res.cloudinary.com/awsimages/image/upload/w_1200,h_630/c_fit,co_rgb:222222,l_text:Helvetica_72_bold:Autocomplete%20Selection%20Menu,w_1080,h_480/fl_layer_apply,g_north_west,x_70,y_70/og-images/html-css-js--og-2022-10-24-blank.png"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site:id" content="@TheIdOfAlan" />
    <meta name="twitter:creator" content="@TheIdOfAlan" />
    <link
      rel="icon"
      type="image/png"
      sizes="228x228"
      href="/favicons/228x228.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="180x180"
      href="/favicons/180x180.png"
    />
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/prism.css" />
    

    <style>
      #selection-text-field {
    background-color: white;
    height: 1.4rem;
    padding: 4px;
    color: black;
}

    </style>
    <script>
      const rawItems = [
    'Roboto',
    'OpenSans',
    'Montserrat',
    'Lato',
    'Poppins',
    'Source Sans Pro',
    'Roboto Condensed',
    'Oswald',
    'Roboto Mono',
    'Raleway',
    'Inter',
    'Noto Sans',
    'Ubuntu',
    'Mukta',
    'Roboto Slab',
    'Nunito',
    'Playfair Display',
    'PT Sans',
    'Nunito Sans',
    'Merriweather',
    'Rubik',
    'Noto Sans KR',
    'Work Sans',
    'Lora',
    'Fira Sans',
]


const Autocomete 




let timeoutIdForBlurTransition = null

const fullList = []
const fullKeys = {}
const currentList = []

let state = {
    activeSelection: '',
}

// let activeFont = ''

// Setup ids for each item
const prepIds = () => {
    for (const rawItem of rawItems) {
        const itemId = rawItem.toLowerCase().replaceAll(/ /g, '')
        fullList.push({
            id: itemId,
            name: rawItem,
        })
        fullKeys[itemId] = rawItem
    }
}

// const clearItems = () => {
//     // Clear any existing items
//     let itemWrapper = document.getElementById('menuItems')
//     while (itemWrapper.firstChild) {
//         console.log('x')
//         itemWrapper.removeChild(itemWrapper.firstChild)
//     }
// }

// const updateItems = (filter) => {
//     // Get the wrapper
//     let itemWrapper = document.getElementById('menuItems')
//     // Clear any existing items
//     activeList.length = 0
//     while (itemWrapper.firstChild) {
//         console.log('x')
//         itemWrapper.removeChild(itemWrapper.firstChild)
//     }
//     // Only add items if there's a filter
//     if (filter) {
//         const pattern = new RegExp(filter, 'gi')
//         listIds.forEach((item) => {
//             const compareItem = item.name.toLowerCase()
//             if (item.name.toLowerCase().match(pattern)) {
//                 activeList.push(item)
//             }
//         })
//     }
//     // Output zero or more things
//     const itemCount = Math.min(5, activeList.length)
//     for (let i = 0; i < itemCount; i++) {
//         const newItem = document.createElement('button')
//         newItem.id = `item--${activeList[i].id}`
//         newItem.innerHTML = activeList[i].name
//         itemWrapper.appendChild(newItem)
//     }
// }

// const handleMenuClick = (event) => {
//     console.log(event.target.id)
//     idParts = event.target.id.split('--')
//     for (const listItem of listIds) {
//         if (idParts[1] === listItem.id) {
//             setActiveItem(listItem.name)
//             updateItems()
//         }
//     }
//     // updateItems(null)
//     // document.getElementById('font-input-field').contentEditable = false
//     // document.getElementById('font-input-field').contentEditable = true
//     // document.getElementById('test-focus-target').focus()
//     // document.getElementById('font-input-field').blur()
// }

// const handleMenuInput = (event) => {
//     console.log(event)
//     const textFilter = document
//         .getElementById('font-input-field')
//         .innerText.trim()
//     updateItems(textFilter)
// }

// const setActiveItem = (itemName) => {
//     console.log(`The new item is: ${itemName}`)
//     document.getElementById('active-font').innerText = itemName
//     document.getElementById('font-input-field').innerText = itemName
//     activeList.length = 0
//     activeFont = itemName
//     // See this: for the bounce here to fix the safari bug about
//     // things not bluring
//     document.getElementById('font-input-field').blur()
//     document.getElementById(
//         'tmp-focus-target-for-safari-fix'
//     ).contentEditable = true
//     document.getElementById('tmp-focus-target-for-safari-fix').focus()
//     document.getElementById('tmp-focus-target-for-safari-fix').blur()
//     document.getElementById(
//         'tmp-focus-target-for-safari-fix'
//     ).contentEditable = false
// }

// const handleKeyUp = (event) => {
//     // TODO: Handle escape
//     // TODO: Handle arrow keys
//     if (event.key.toLowerCase() === 'enter') {
//         console.log('Caught enter')
//         if (activeList[0]) {
//             setActiveItem(activeList[0].name)
//             updateItems()
//         }
//         document.getElementById('font-input-field').innerText = document
//             .getElementById('font-input-field')
//             .innerText.replaceAll(/\n/g, '')
//     }
// }

const handleInputFocus = (event) => {
    if (timeoutIdForBlurTransition) {
        clearTimeout(timeoutIdForBlurTransition)
    }
    event.target.innerText = ''
    const selectionsEl = document.getElementById('selections')
    while (selectionsEl.firstChild) {
        selectionsEl.removeChild(selectionsEl.firstChild)
    }
    for (let i = 0; i < 5; i++) {
        const newItem = document.createElement('button')
        newItem.id = `selection--${fullList[i].id}`
        newItem.innerHTML = fullList[i].name
        newItem.className = 'selection--button'
        newItem.addEventListener('focus', handleButtonFocus)
        newItem.addEventListener('blur', handleButtonBlur)
        newItem.addEventListener('click', handleButtonClick)
        selections.appendChild(newItem)
    }
}

const handleButtonClick = (event) => {
    const selectionsEl = document.getElementById('selections')
    while (selectionsEl.firstChild) {
        selectionsEl.removeChild(selectionsEl.firstChild)
    }
    const parts = event.target.id.split('--')
    state.activeSelection = fullKeys[parts[1]]
    console.log(state.activeSelection)
    document.getElementById(
        'active-selection'
    ).innerText = `Active Selection: ${state.activeSelection}`
    document.getElementById('selection-text-field').innerText =
        state.activeSelection
}

const handleButtonFocus = () => {
    if (timeoutIdForBlurTransition) {
        clearTimeout(timeoutIdForBlurTransition)
    }
}

const handleButtonBlur = () => {
    if (timeoutIdForBlurTransition) {
        clearTimeout(timeoutIdForBlurTransition)
    }
    timeoutIdForBlurTransition = setTimeout(() => {
        const selectionsEl = document.getElementById('selections')
        while (selectionsEl.firstChild) {
            selectionsEl.removeChild(selectionsEl.firstChild)
        }
    }, 30)
}

const handleInputBlur = () => {
    console.log('-- Input blur')
    if (timeoutIdForBlurTransition) {
        clearTimeout(timeoutIdForBlurTransition)
    }
    timeoutIdForBlurTransition = setTimeout(() => {
        const selectionsEl = document.getElementById('selections')
        while (selectionsEl.firstChild) {
            selectionsEl.removeChild(selectionsEl.firstChild)
        }
        document.getElementById(
            'active-selection'
        ).innerText = `Active Selection: ${state.activeSelection}`
    }, 30)
}

// const handleBlur = (event) => {
//     event.target.innerText = activeFont
//     // if (timeoutIdFixForBlur) {
//     //     clearTimeout(timeoutIdFixForBlur)
//     // }
//     // timeoutIdFixForBlur = setTimeout(() => {
//     //     event.target.innerText = activeFont
//     //     let itemWrapper = document.getElementById('menuItems')
//     //     while (itemWrapper.firstChild) {
//     //         console.log('x')
//     //         itemWrapper.removeChild(itemWrapper.firstChild)
//     //     }
//     // }, 100)
// }

const kickoff = () => {
    console.log(`Kickoff: ${new Date().getTime()}`)
    prepIds()
    document
        .getElementById('selection-text-field')
        .addEventListener('focus', handleInputFocus)
    document
        .getElementById('selection-text-field')
        .addEventListener('blur', handleInputBlur)

    // document
    //     .getElementById('menuItems')
    //     .addEventListener('click', handleMenuClick)
    // document
    //     .getElementById('menuWrapper')
    //     .addEventListener('input', handleMenuInput)
    // document
    //     .getElementById('menuWrapper')
    //     .addEventListener('keyup', handleKeyUp)

    // updateItems()
}

document.addEventListener('DOMContentLoaded', kickoff)

    </script>
  </head>
  <body>
    <header>
      <a href="/">Cookbook Home</a> ~
      <a href="https://www.alanwsmith.com/">alanwsmith.com</a> ~
      <a href="https://links.alanwsmith.com">links</a> ~
      <a href="https://podcast.alanwsmith.com/">podcast</a>
    </header>
    <main>
      <h1>Autocomplete Select Menu</h1>
      <p>This is a work in progress. It doesn't work yet.</p>
      <div id="tmp-focus-target-for-safari-fix"></div>
      <div id="active-selection">Active Selection: None</div>
<div id="selection-text-field" contenteditable="true"></div>
<div id="selections"></div>

      
      <h2>Target behavior</h2>
      <ul>
        <li>Filter selections based on text input</li>
        <li>Show auto complete for typing</li>
        <li>
          Pressing enter fires the event with whatever the top item is in the
          list
        </li>
        <li>Clicking an item fires the event</li>
        <li>Only show N number of items regardless of list length</li>
        <li>Accessible</li>
        <li>
          Put the current value in as a placeholder when something is selected
        </li>
      </ul>

      <h2>Notes</h2>
      <ul>
        <li>This uses a small font list for the items to search</li>
        <li>
          This uses a very naive approach to the search. If the string in the
          input field matches anywhere in the item list it gets included.
        </li>
      </ul>

      <h2>TODO</h2>
      <ul>
        <li>Put eyes on the specificity of things</li>
        <li>
          Dig through this for multiline suppression:
          https://stackoverflow.com/questions/6831482/contenteditable-single-line-input
        </li>
      </ul>
    </main>
    <footer>
      made by <a href="https://twitter.com/TheIdOfAlan">
      <br />
      who has a <a href="https://www.alanwsmith.com">website</a> and a
      <a href="https://podcast.alanwsmith.com/">podcast</a> <br />
      among other <a href="https://links.alanwsmith.com">things</a>
    </footer>
  </body>
</html>
