<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Autocomplete Select Menu - The HTML, CSS, and JavaScript Cookbook Of Alan
    </title>
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Autocomplete Select Menu - The HTML, CSS, and JavaScript Cookbook Of Alan"
    />
    <meta
      property="og:description"
      content="Type or click to get your selection"
    />
    <meta
      property="og:image"
      content="https://html-css-js-cookbook.alanwsmith.com/og-images/main.jpg"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site:id" content="@TheIdOfAlan" />
    <meta name="twitter:creator" content="@TheIdOfAlan" />
    <link
      rel="icon"
      type="image/png"
      sizes="228x228"
      href="/favicons/228x228.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="180x180"
      href="/favicons/180x180.png"
    />
    <link rel="stylesheet" href="/styles.css" />
    <style>
      #font-input-field {
    background-color: white;
    height: 1.6rem;
    color: black;
}

    </style>
    <script>
      const itemList = [
    'Roboto',
    'OpenSans',
    'Montserrat',
    'Lato',
    'Poppins',
    'Source Sans Pro',
    'Roboto Condensed',
    'Oswald',
    'Roboto Mono',
    'Raleway',
    'Inter',
    'Noto Sans',
    'Ubuntu',
    'Mukta',
    'Roboto Slab',
    'Nunito',
    'Playfair Display',
    'PT Sans',
    'Nunito Sans',
    'Merriweather',
    'Rubik',
    'Noto Sans KR',
    'Work Sans',
    'Lora',
    'Fira Sans',
]

const activeList = []
const listKeys = []

// Setup keys that can be used as IDs
const prepKeys = () => {
    for (const item of itemList) {
        // listKeys.push({`${item.toLowerCase().replaceAll(/ /g, '')}`: item })
        listKeys.push({
            id: item.toLowerCase().replaceAll(/ /g, ''),
            name: item,
        })
    }
}

const updateItems = (filter) => {
    // Clear any existing items
    const itemWrapper = document.getElementById('menuItems')
    while (itemWrapper.children.length > 0) {
        itemWrapper.children[0].remove()
    }

    // Only add stuff if there's input to filter off of
    if (filter) {
        activeList.length = 0
        const pattern = new RegExp(filter, 'gi')
        listKeys.forEach((item) => {
            const compareItem = item.name.toLowerCase()
            if (item.name.toLowerCase().match(pattern)) {
                activeList.push(item)
            }
        })
    }

    // // Only add stuff if there's input to filter off of
    // if (filter) {
    //     activeList.length = 0
    //     const pattern = new RegExp(filter, 'gi')
    //     itemList.forEach((item) => {
    //         const compareItem = item.toLowerCase()
    //         if (item.toLowerCase().match(pattern)) {
    //             activeList.push(item)
    //         }
    //     })
    // }

    const itemCount = Math.min(5, activeList.length)
    for (let i = 0; i < itemCount; i++) {
        const newItem = document.createElement('button')
        newItem.id = `item--${activeList[i].id}`
        newItem.innerHTML = activeList[i].name
        itemWrapper.appendChild(newItem)
    }
}

const handleMenuClick = (event) => {
    console.log(event)
}

const handleMenuInput = (event) => {
    console.log(event)
    const textFilter = document
        .getElementById('font-input-field')
        .innerText.trim()
    console.log(`-${textFilter}-`)
    updateItems(textFilter)
}

const handleKeyUp = (event) => {
    // TODO: Handle escape and tab
    // TODO: Handle arrow keys
    if (event.key.toLowerCase() === 'enter') {
        console.log('Caught enter')
        if (activeList[0]) {
            console.log(`THING: ${activeList[0]}`)
            document.getElementById('active-font').innerText =
                activeList[0].name
            document.getElementById('font-input-field').innerText = ''
            activeList.length = 0
            updateItems()
        }
        document.getElementById('font-input-field').innerText = document
            .getElementById('font-input-field')
            .innerText.replaceAll(/\n/g, '')
    }
}

const kickoff = () => {
    console.log(`Kickoff: ${new Date().getTime()}`)
    prepKeys()
    document
        .getElementById('menuItems')
        .addEventListener('click', handleMenuClick)
    document
        .getElementById('menuWrapper')
        .addEventListener('input', handleMenuInput)

    document
        .getElementById('menuWrapper')
        .addEventListener('keyup', handleKeyUp)
    updateItems()
}
document.addEventListener('DOMContentLoaded', kickoff)

    </script>
  </head>
  <body>
    <header>
      <a href="/">Cookbook Home</a> ~
      <a href="https://www.alanwsmith.com/">alanwsmith.com</a> ~
      <a href="https://links.alanwsmith.com">links</a> ~
      <a href="https://podcast.alanwsmith.com/">podcast</a>
    </header>
    <main>
      <h1>Autocomplete Select Menu</h1>
      <p>This is a work in progress. It's not fully functional yet</p>
      <hr />
      <div id="active-font-wrapper">
  Active Font: <span id="active-font"></span>
</div>

</div>
<div id="menuWrapper">
  <div id="font-input-field" contenteditable="true"></div>
</div>
  <div id="menuItems"></div>

      <hr />

      <h3>Source</h3>

      <h2>Target behavior</h2>
      <ul>
        <li>Filter selections based on text input</li>
        <li>Show auto complete for typing</li>
        <li>
          Pressing enter fires the event with whatever the top item is in the
          list
        </li>
        <li>Clicking an item fires the event</li>
        <li>Only show N number of items regardless of list length</li>
        <li>Accessible</li>
        <li>
          Put the current value in as a placeholder when something is selected
        </li>
      </ul>

      <h2>Notes</h2>
      <ul>
        <li>This uses a small font list for the items to search</li>
        <li>
          This uses a very naive approach to the search. If the string in the
          input field matches anywhere in the item list it gets included.
        </li>
      </ul>

      <h2>TODO</h2>
      <ul>
        <li>Put eyes on the specificity of things</li>
        <li>
          Dig through this for multiline suppression:
          https://stackoverflow.com/questions/6831482/contenteditable-single-line-input
        </li>
      </ul>
    </main>
    <footer>
      made by <a href="https://twitter.com/TheIdOfAlan">alan w. smith</a>
      <br />
      who has a <a href="https://www.alanwsmith.com">website</a> and a
      <a href="https://podcast.alanwsmith.com/">podcast</a> <br />
      among other <a href="https://links.alanwsmith.com">things</a>
    </footer>
  </body>
</html>
