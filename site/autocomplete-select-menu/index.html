<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Autocomplete Select Menu - The HTML, CSS, and JavaScript Cookbook Of Alan
    </title>
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Autocomplete Select Menu - The HTML, CSS, and JavaScript Cookbook Of Alan"
    />
    <meta
      property="og:description"
      content="Type or click to get your selection"
    />
    <meta
      property="og:image"
      content="https://html-css-js-cookbook.alanwsmith.com/og-images/main.jpg"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site:id" content="@TheIdOfAlan" />
    <meta name="twitter:creator" content="@TheIdOfAlan" />
    <link
      rel="icon"
      type="image/png"
      sizes="228x228"
      href="/favicons/228x228.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="180x180"
      href="/favicons/180x180.png"
    />
    <link rel="stylesheet" href="/styles.css" />
    <style>
      #font-input-field {
    background-color: white;

    height: 1.6rem;

    padding: 4px;
    color: black;
}

    </style>
    <script>
      const itemList = [
    'Roboto',
    'OpenSans',
    'Montserrat',
    'Lato',
    'Poppins',
    'Source Sans Pro',
    'Roboto Condensed',
    'Oswald',
    'Roboto Mono',
    'Raleway',
    'Inter',
    'Noto Sans',
    'Ubuntu',
    'Mukta',
    'Roboto Slab',
    'Nunito',
    'Playfair Display',
    'PT Sans',
    'Nunito Sans',
    'Merriweather',
    'Rubik',
    'Noto Sans KR',
    'Work Sans',
    'Lora',
    'Fira Sans',
]

const activeList = []
const listIds = []

let activeFont = ''

// Setup ids for each item
const prepIds = () => {
    for (const item of itemList) {
        listIds.push({
            id: item.toLowerCase().replaceAll(/ /g, ''),
            name: item,
        })
    }
}

const updateItems = (filter) => {
    // Get the wrapper
    let itemWrapper = document.getElementById('menuItems')

    // Clear any existing items
    activeList.length = 0
    while (itemWrapper.firstChild) {
        console.log('x')
        itemWrapper.removeChild(itemWrapper.firstChild)
    }

    // Only add items if there's a filter
    if (filter) {
        const pattern = new RegExp(filter, 'gi')
        listIds.forEach((item) => {
            const compareItem = item.name.toLowerCase()
            if (item.name.toLowerCase().match(pattern)) {
                activeList.push(item)
            }
        })
    }

    // Output zero or more things
    const itemCount = Math.min(5, activeList.length)
    for (let i = 0; i < itemCount; i++) {
        const newItem = document.createElement('button')
        newItem.id = `item--${activeList[i].id}`
        newItem.innerHTML = activeList[i].name
        itemWrapper.appendChild(newItem)
    }
}

const handleMenuClick = (event) => {
    console.log(event.target.id)
    idParts = event.target.id.split('--')
    for (const listItem of listIds) {
        if (idParts[1] === listItem.id) {
            setActiveItem(listItem.name)
        }
    }
    updateItems(null)
}

const handleMenuInput = (event) => {
    console.log(event)
    const textFilter = document
        .getElementById('font-input-field')
        .innerText.trim()
    updateItems(textFilter)
}

const setActiveItem = (itemName) => {
    console.log(`The new item is: ${itemName}`)
    document.getElementById('active-font').innerText = itemName
    document.getElementById('font-input-field').innerText = itemName
    activeList.length = 0
    activeFont = itemName
    document.getElementById('font-input-field').blur()
}

const handleKeyUp = (event) => {
    // TODO: Handle escape
    // TODO: Handle arrow keys
    if (event.key.toLowerCase() === 'enter') {
        console.log('Caught enter')
        if (activeList[0]) {
            setActiveItem(activeList[0].name)

            updateItems()
        }
        document.getElementById('font-input-field').innerText = document
            .getElementById('font-input-field')
            .innerText.replaceAll(/\n/g, '')
    }
}

const handleFocus = (event) => {
    event.target.innerText = ''
}

const handleBlur = (event) => {
    event.target.innerText = activeFont
}

const kickoff = () => {
    console.log(`Kickoff: ${new Date().getTime()}`)
    prepIds()
    document
        .getElementById('menuItems')
        .addEventListener('click', handleMenuClick)
    document
        .getElementById('menuWrapper')
        .addEventListener('input', handleMenuInput)
    document
        .getElementById('font-input-field')
        .addEventListener('focus', handleFocus)
    document
        .getElementById('font-input-field')
        .addEventListener('blur', handleBlur)
    document
        .getElementById('menuWrapper')
        .addEventListener('keyup', handleKeyUp)
    updateItems()
}
document.addEventListener('DOMContentLoaded', kickoff)

    </script>
  </head>
  <body>
    <header>
      <a href="/">Cookbook Home</a> ~
      <a href="https://www.alanwsmith.com/">alanwsmith.com</a> ~
      <a href="https://links.alanwsmith.com">links</a> ~
      <a href="https://podcast.alanwsmith.com/">podcast</a>
    </header>
    <main>
      <h1>Autocomplete Select Menu</h1>
      <p>This is a work in progress. It's not fully functional yet</p>
      <hr />
      <div id="active-font-wrapper">Active Font: <span id="active-font"></span></div>

<div id="menuWrapper">
  <div id="font-input-field" contenteditable="true"></div>
</div>
<div id="menuItems"></div>

      <hr />

      <h3>Source</h3>

      <h2>Target behavior</h2>
      <ul>
        <li>Filter selections based on text input</li>
        <li>Show auto complete for typing</li>
        <li>
          Pressing enter fires the event with whatever the top item is in the
          list
        </li>
        <li>Clicking an item fires the event</li>
        <li>Only show N number of items regardless of list length</li>
        <li>Accessible</li>
        <li>
          Put the current value in as a placeholder when something is selected
        </li>
      </ul>

      <h2>Notes</h2>
      <ul>
        <li>This uses a small font list for the items to search</li>
        <li>
          This uses a very naive approach to the search. If the string in the
          input field matches anywhere in the item list it gets included.
        </li>
      </ul>

      <h2>TODO</h2>
      <ul>
        <li>Put eyes on the specificity of things</li>
        <li>
          Dig through this for multiline suppression:
          https://stackoverflow.com/questions/6831482/contenteditable-single-line-input
        </li>
      </ul>
    </main>
    <footer>
      made by <a href="https://twitter.com/TheIdOfAlan">alan w. smith</a>
      <br />
      who has a <a href="https://www.alanwsmith.com">website</a> and a
      <a href="https://podcast.alanwsmith.com/">podcast</a> <br />
      among other <a href="https://links.alanwsmith.com">things</a>
    </footer>
  </body>
</html>
