<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Code Documentation Maker - The HTML, CSS, and JavaScript Cookbook Of Alan</title>
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Live Code Documentation Maker" />
    <meta property="og:description" content="" />
    <meta
      property="og:image"
      content="https://res.cloudinary.com/awsimages/image/upload/w_1200,h_630/c_fit,co_rgb:222222,l_text:Helvetica_72_bold:Live%20Code%20Documentation%20Maker,w_1080,h_480/fl_layer_apply,g_north_west,x_70,y_70/og-images/html-css-js--og-2022-10-24-blank.png"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site:id" content="@TheIdOfAlan" />
    <meta name="twitter:creator" content="@TheIdOfAlan" />
    <link
      rel="icon"
      type="image/png"
      sizes="228x228"
      href="/favicons/228x228.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="180x180"
      href="/favicons/180x180.png"
    />
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/prism.css" />
    
    <style>
      
    </style>
    <script>
      
    </script>
  </head>
  <body>
    <header>
      <a href="/">Cookbook Home</a> ~
      <a href="https://www.alanwsmith.com/">alanwsmith.com</a> ~
      <a href="https://links.alanwsmith.com">links</a> ~
      <a href="https://podcast.alanwsmith.com/">podcast</a> ~
      <a href="https://https://twitter.com/TheIdOfAlan">twitter</a>
    </header>
    <main>
      <h1>Live Code Documentation Maker</h1>
      
                <h2>DETAILS</h2>
                <ul>
                    <li>This is an initail exploration of creating source code documentation with metadata that identifies what lines they apply to. The goal is to make sure the source code you post is the same source code you ran when verifying it works. No more botched examples becase of copy/paste goofs.</li>
                </ul>
                
      <h2>EXAMPLE</h2>
      <p>
  This is a live example that uses the source code of the pyton script that
  generated these snippets as it's own target. This is the full file. Snippet
  examples and more notes are further below.
</p>


<pre class="language-py"><code class="language-py">
1&nbsp;&nbsp;#!/usr/bin/env python3
2&nbsp;&nbsp;
3&nbsp;&nbsp;import glob
4&nbsp;&nbsp;import json 
5&nbsp;&nbsp;import os
6&nbsp;&nbsp;
7&nbsp;&nbsp;class SnippetDocumentor():
8&nbsp;&nbsp;
9&nbsp;&nbsp;    def __init__(self):
10&nbsp;&nbsp;        self.source = []
11&nbsp;&nbsp;        self.docs = []
12&nbsp;&nbsp;        self.content = []
13&nbsp;&nbsp;
14&nbsp;&nbsp;    def assemble_content(self, output_path):
15&nbsp;&nbsp;        for doc in self.docs:
16&nbsp;&nbsp;            parts = doc.split('---')
17&nbsp;&nbsp;            meta = json.loads(parts[1])
18&nbsp;&nbsp;            self.content.append(parts[0])
19&nbsp;&nbsp;            self.content.append('<pre class="language-py"><code class="language-py">')
20&nbsp;&nbsp;            for line_group in meta['lines']:
21&nbsp;&nbsp;                for line_index in range(line_group[0] - 1, line_group[1]):
22&nbsp;&nbsp;                    self.content.append(
23&nbsp;&nbsp;                        f"{line_index + 1}&nbsp;&nbsp;{self.source[line_index]}"
24&nbsp;&nbsp;                    )
25&nbsp;&nbsp;            self.content.append('</pre></code>')
26&nbsp;&nbsp;
27&nbsp;&nbsp;        with open(output_path, 'w') as _out:
28&nbsp;&nbsp;            _out.write("\n".join(self.content))
29&nbsp;&nbsp;
30&nbsp;&nbsp;    def load_source(self, source_path):
31&nbsp;&nbsp;        with open(source_path) as _source:
32&nbsp;&nbsp;            self.source = _source.read().split("\n")
33&nbsp;&nbsp;
34&nbsp;&nbsp;    def load_docs(self, docs_dir):
35&nbsp;&nbsp;        local_file_list = [
36&nbsp;&nbsp;            file for file in glob.glob(f"{docs_dir}/*")
37&nbsp;&nbsp;            if os.path.isfile(file)
38&nbsp;&nbsp;        ]
39&nbsp;&nbsp;        local_file_list.sort()
40&nbsp;&nbsp;        for local_file in local_file_list:
41&nbsp;&nbsp;            with open(local_file) as _in:
42&nbsp;&nbsp;                self.docs.append(_in.read())
43&nbsp;&nbsp;
44&nbsp;&nbsp;if __name__ == "__main__":
45&nbsp;&nbsp;    working_dir = os.path.dirname(os.path.realpath(__file__))
46&nbsp;&nbsp;
47&nbsp;&nbsp;    sd = SnippetDocumentor()
48&nbsp;&nbsp;    sd.load_source(__file__)
49&nbsp;&nbsp;    sd.load_docs(f"{working_dir}/docs")
50&nbsp;&nbsp;    sd.assemble_content(f"{working_dir}/DOCSCONTENT.html")
51&nbsp;&nbsp;
</pre></code>
<p>
  The docs files pull out lines from the original source for direct display
  instead of having to copy/paste them. Here's a few lines pulled from the same
  source file as above.
</p>


<pre class="language-py"><code class="language-py">
31&nbsp;&nbsp;        with open(source_path) as _source:
32&nbsp;&nbsp;            self.source = _source.read().split("\n")
33&nbsp;&nbsp;
</pre></code>
<p>
  Note that because lines are all coming from the same source it's trivial to
  show line numbers that match the location of the full file. I'm not sure I'm
  going to like that in the long term, but my early impression is good.
</p>
<p>
  There's no need for the lines to be consequetive. Here's an example with a
  split.
</p>


<pre class="language-py"><code class="language-py">
9&nbsp;&nbsp;    def __init__(self):
10&nbsp;&nbsp;        self.source = []
11&nbsp;&nbsp;        self.docs = []
12&nbsp;&nbsp;        self.content = []
13&nbsp;&nbsp;
47&nbsp;&nbsp;    sd = SnippetDocumentor()
48&nbsp;&nbsp;    sd.load_source(__file__)
49&nbsp;&nbsp;    sd.load_docs(f"{working_dir}/docs")
50&nbsp;&nbsp;    sd.assemble_content(f"{working_dir}/DOCSCONTENT.html")
51&nbsp;&nbsp;
</pre></code> 
            <h2>DOCS FILE EXAMPLE</h2>
            <p>This is an example of the docs file format I'm using. It's plain HTML with a `---` at the end followed by a JSON string that identifes what lines to show.</p>
            <pre><code class="language-html">&lt;p&gt;
  Note that because lines are all coming from the same source it&#x27;s trivial to
  show line numbers that match the location of the full file. I&#x27;m not sure I&#x27;m
  going to like that in the long term, but my early impression is good.
&lt;/p&gt;
&lt;p&gt;
  There&#x27;s no need for the lines to be consequetive. Here&#x27;s an example with a
  split.
&lt;/p&gt;

--- { &quot;lines&quot;: [[9,13], [46,50]] }
</code></pre>
            
      <hr />
      
 
            <h2>PYTHON SOURCE</h2>
            <pre><code class="language-py">#!/usr/bin/env python3

import glob
import json 
import os

class SnippetDocumentor():

    def __init__(self):
        self.source = []
        self.docs = []
        self.content = []

    def assemble_content(self, output_path):
        for doc in self.docs:
            parts = doc.split(&#x27;---&#x27;)
            meta = json.loads(parts[1])
            self.content.append(parts[0])
            self.content.append(&#x27;&lt;pre class=&quot;language-py&quot;&gt;&lt;code class=&quot;language-py&quot;&gt;&#x27;)
            for line_group in meta[&#x27;lines&#x27;]:
                for line_index in range(line_group[0] - 1, line_group[1]):
                    self.content.append(
                        f&quot;{line_index + 1}&amp;nbsp;&amp;nbsp;{self.source[line_index]}&quot;
                    )
            self.content.append(&#x27;&lt;/pre&gt;&lt;/code&gt;&#x27;)

        with open(output_path, &#x27;w&#x27;) as _out:
            _out.write(&quot;\n&quot;.join(self.content))

    def load_source(self, source_path):
        with open(source_path) as _source:
            self.source = _source.read().split(&quot;\n&quot;)

    def load_docs(self, docs_dir):
        local_file_list = [
            file for file in glob.glob(f&quot;{docs_dir}/*&quot;)
            if os.path.isfile(file)
        ]
        local_file_list.sort()
        for local_file in local_file_list:
            with open(local_file) as _in:
                self.docs.append(_in.read())

if __name__ == &quot;__main__&quot;:
    working_dir = os.path.dirname(os.path.realpath(__file__))

    sd = SnippetDocumentor()
    sd.load_source(__file__)
    sd.load_docs(f&quot;{working_dir}/docs&quot;)
    sd.assemble_content(f&quot;{working_dir}/DOCSCONTENT.html&quot;)

</code></pre>
              
            <h2>HTML</h2>
            <pre><code class="language-html">
</code></pre>
             
         
                <h2>References</h2>
                <ul>
                    <li><a href=""></a></li>
                </ul>
                
    </main>
    <footer>
      made by <a href="https://twitter.com/TheIdOfAlan">alan w. smith</a>
      <br />
      who has a <a href="https://www.alanwsmith.com">website</a> and a
      <a href="https://podcast.alanwsmith.com/">podcast</a> <br />
      among other <a href="https://links.alanwsmith.com">things</a>
    </footer>
    <script src="/styles/prism.js"></script>
  </body>
</html>
