<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enforced Selection Form Control - The HTML, CSS, and JavaScript Cookbook Of Alan</title>
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Enforced Selection Form Control" />
    <meta property="og:description" content="Goal: a form control that lets you pick from a selection by typing but only from the available selections" />
    <meta
      property="og:image"
      content="https://res.cloudinary.com/awsimages/image/upload/w_1200,h_630/c_fit,co_rgb:222222,l_text:Helvetica_72_bold:Enforced%20Selection%20Form%20Control,w_1080,h_480/fl_layer_apply,g_north_west,x_70,y_70/og-images/html-css-js--og-2022-10-24-blank.png"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site:id" content="@TheIdOfAlan" />
    <meta name="twitter:creator" content="@TheIdOfAlan" />
    <link
      rel="icon"
      type="image/png"
      sizes="228x228"
      href="/favicons/228x228.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="180x180"
      href="/favicons/180x180.png"
    />
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/prism.css" />
    
    <style>
      
    </style>
    <script>
      class EnforcedSelector extends HTMLElement {
    constructor() {
        super()
        this.attachShadow({ mode: 'open' })
        this.defaultOptions = {}
        this.placeholder = 'Select'
        this.options = []
        this.upArrowCheck = ''

        const log = (msg) => {
            console.log(msg)
        }

        const handleDocumentClick = (event) => {
            if (event.target !== this) {
                this.input.value = ''
                removeMenu()
            }
        }

        const handleInputFocus = () => {
            this.input.setAttribute('placeholder', '')
            renderOptions()
        }

        const handleInputKeydown = (event) => {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === 'tab') {
                event.preventDefault()
                setSelection(0)
                this.select.focus()
            }
        }

        const handleInputKeyup = (event) => {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === 'enter') {
                if (this.input.value !== '') {
                    if (this.options.length > 0) {
                        registerSelection()
                    }
                }
            } else if (keyCheck === 'arrowdown') {
                if (this.input.value === '') {
                    setSelection(0)
                } else {
                    setSelection(1)
                }
                this.select.focus()
            } else if (keyCheck === 'escape') {
                if (this.input.value !== '') {
                    this.input.value = ''
                    renderOptions()
                } else {
                    this.input.setAttribute('placeholder', this.placeholder)
                    removeMenu()
                    this.input.blur()
                }
            } else {
                renderOptions()
            }
        }

        const handleSelectKeydown = (event) => {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === 'tab') {
                event.preventDefault()
                this.input.focus()
            }
        }

        const handleSelectKeyup = (event) => {
            const keyCheck = event.key.toLowerCase()
            // TODO: May need to be a check for items in the
            // options here.
            if (keyCheck === 'enter') {
                registerSelection()

                // } else if (keyCheck === 'escape') {
                // log('TODO: Hanlde escape here')
                // registerSelection()
            } else if (keyCheck === 'arrowup') {
                if (this.upArrowCheck === this.select.value) {
                    this.input.focus()
                    setSelection(null)
                }
            }
            if (this.select) {
                this.upArrowCheck = this.select.value
            }
        }

        const registerSelection = () => {
            for (let option of this.options) {
                if (this.select.value === option.value) {
                    this.placeholder = option.text
                    this.input.setAttribute('placeholder', this.placeholder)
                    this.input.value = ''
                    this.input.blur()
                }
            }
            removeMenu()
        }

        const removeMenu = () => {
            if (this.select) {
                while (this.select.firstChild) {
                    this.select.firstChild.remove()
                }
                this.select.blur()
                this.select.remove()
                this.select = null
            }
        }

        const renderOptions = () => {
            if (this.select) {
                while (this.select.firstChild) {
                    this.select.firstChild.remove()
                }
                this.select.blur()
                this.select.remove()
                this.select = null
            }

            updateOptions()

            this.select = document.createElement('select')
            this.select.addEventListener('keydown', handleSelectKeydown)
            this.select.addEventListener('keyup', handleSelectKeyup)
            this.select.size = 5

            for (let option of this.options) {
                this.select.appendChild(option)
            }

            this.wrapper.appendChild(this.select)

            if (this.input.value !== '' && this.options.length > 0) {
                setSelection(0)
            }

            this.upArrowCheck = null
        }

        const setSelection = (index = null) => {
            for (let option of this.options) {
                option.removeAttribute('selected')
            }
            if (index !== null) {
                this.upArrowCheck = this.options[index].value
                this.options[index].setAttribute('selected', true)
            }
        }

        // this makes new object to avoid having to worry about
        // stuff with the outside set. but it looks at that
        // set every time to make it's stuff
        const updateOptions = () => {
            this.options = []
            for (let option of this.getElementsByTagName('option')) {
                if (option.text.toLowerCase().includes(this.input.value)) {
                    const optionEl = document.createElement('option')
                    optionEl.value = option.value
                    optionEl.innerText = option.text
                    this.options.push(optionEl)
                }
            }
        }

        this.wrapper = document.createElement('div')
        this.wrapper.style.display = 'inline'

        this.input = document.createElement('input')
        this.input.setAttribute('value', '')
        this.input.setAttribute('type', 'text')
        this.input.setAttribute('placeholder', this.placeholder)
        this.input.addEventListener('focus', handleInputFocus)
        this.input.addEventListener('keyup', handleInputKeyup)
        this.input.addEventListener('keydown', handleInputKeydown)
        this.input.setAttribute('autocorrect', false)
        this.input.setAttribute('spellcheck', false)

        this.wrapper.appendChild(this.input)
        this.shadowRoot.append(this.wrapper)

        document.addEventListener('mousedown', handleDocumentClick)
    }
}

customElements.define('enforced-selector', EnforcedSelector)

    </script>
  </head>
  <body class="line-numbers">
    <header>
      <a href="/">Cookbook Home</a> ~
      <a href="https://www.alanwsmith.com/">alanwsmith.com</a> ~
      <a href="https://links.alanwsmith.com">links</a> ~
      <a href="https://podcast.alanwsmith.com/">podcast</a> ~
      <a href="https://https://twitter.com/TheIdOfAlan">twitter</a>
    </header>
    <main>
      <h1>Enforced Selection Form Control</h1>
      <h2>Example</h2>
      <enforced-selector>
  <option value="roboto">Roboto</option>
  <option value="opensans">Open Sans</option>
  <option value="notosansjp">Noto Sans JP</option>
  <option value="montserrat">Montserrat</option>
  <option value="lato">Lato</option>
  <option value="poppins">Poppins</option>
  <option value="sourcesanspro">Source Sans Pro</option>
</enforced-selector>
  
            <h2>HTML</h2>
            <pre><code class="language-html">&lt;enforced-selector&gt;
  &lt;option value=&quot;roboto&quot;&gt;Roboto&lt;/option&gt;
  &lt;option value=&quot;opensans&quot;&gt;Open Sans&lt;/option&gt;
  &lt;option value=&quot;notosansjp&quot;&gt;Noto Sans JP&lt;/option&gt;
  &lt;option value=&quot;montserrat&quot;&gt;Montserrat&lt;/option&gt;
  &lt;option value=&quot;lato&quot;&gt;Lato&lt;/option&gt;
  &lt;option value=&quot;poppins&quot;&gt;Poppins&lt;/option&gt;
  &lt;option value=&quot;sourcesanspro&quot;&gt;Source Sans Pro&lt;/option&gt;
&lt;/enforced-selector&gt;
</code></pre>
              
            <h2>JavaScript</h2>
            <pre><code class="language-js">class EnforcedSelector extends HTMLElement {
    constructor() {
        super()
        this.attachShadow({ mode: &#x27;open&#x27; })
        this.defaultOptions = {}
        this.placeholder = &#x27;Select&#x27;
        this.options = []
        this.upArrowCheck = &#x27;&#x27;

        const log = (msg) =&gt; {
            console.log(msg)
        }

        const handleDocumentClick = (event) =&gt; {
            if (event.target !== this) {
                this.input.value = &#x27;&#x27;
                removeMenu()
            }
        }

        const handleInputFocus = () =&gt; {
            this.input.setAttribute(&#x27;placeholder&#x27;, &#x27;&#x27;)
            renderOptions()
        }

        const handleInputKeydown = (event) =&gt; {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === &#x27;tab&#x27;) {
                event.preventDefault()
                setSelection(0)
                this.select.focus()
            }
        }

        const handleInputKeyup = (event) =&gt; {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === &#x27;enter&#x27;) {
                if (this.input.value !== &#x27;&#x27;) {
                    if (this.options.length &gt; 0) {
                        registerSelection()
                    }
                }
            } else if (keyCheck === &#x27;arrowdown&#x27;) {
                if (this.input.value === &#x27;&#x27;) {
                    setSelection(0)
                } else {
                    setSelection(1)
                }
                this.select.focus()
            } else if (keyCheck === &#x27;escape&#x27;) {
                if (this.input.value !== &#x27;&#x27;) {
                    this.input.value = &#x27;&#x27;
                    renderOptions()
                } else {
                    this.input.setAttribute(&#x27;placeholder&#x27;, this.placeholder)
                    removeMenu()
                    this.input.blur()
                }
            } else {
                renderOptions()
            }
        }

        const handleSelectKeydown = (event) =&gt; {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === &#x27;tab&#x27;) {
                event.preventDefault()
                this.input.focus()
            }
        }

        const handleSelectKeyup = (event) =&gt; {
            const keyCheck = event.key.toLowerCase()
            // TODO: May need to be a check for items in the
            // options here.
            if (keyCheck === &#x27;enter&#x27;) {
                registerSelection()

                // } else if (keyCheck === &#x27;escape&#x27;) {
                // log(&#x27;TODO: Hanlde escape here&#x27;)
                // registerSelection()
            } else if (keyCheck === &#x27;arrowup&#x27;) {
                if (this.upArrowCheck === this.select.value) {
                    this.input.focus()
                    setSelection(null)
                }
            }
            if (this.select) {
                this.upArrowCheck = this.select.value
            }
        }

        const registerSelection = () =&gt; {
            for (let option of this.options) {
                if (this.select.value === option.value) {
                    this.placeholder = option.text
                    this.input.setAttribute(&#x27;placeholder&#x27;, this.placeholder)
                    this.input.value = &#x27;&#x27;
                    this.input.blur()
                }
            }
            removeMenu()
        }

        const removeMenu = () =&gt; {
            if (this.select) {
                while (this.select.firstChild) {
                    this.select.firstChild.remove()
                }
                this.select.blur()
                this.select.remove()
                this.select = null
            }
        }

        const renderOptions = () =&gt; {
            if (this.select) {
                while (this.select.firstChild) {
                    this.select.firstChild.remove()
                }
                this.select.blur()
                this.select.remove()
                this.select = null
            }

            updateOptions()

            this.select = document.createElement(&#x27;select&#x27;)
            this.select.addEventListener(&#x27;keydown&#x27;, handleSelectKeydown)
            this.select.addEventListener(&#x27;keyup&#x27;, handleSelectKeyup)
            this.select.size = 5

            for (let option of this.options) {
                this.select.appendChild(option)
            }

            this.wrapper.appendChild(this.select)

            if (this.input.value !== &#x27;&#x27; &amp;&amp; this.options.length &gt; 0) {
                setSelection(0)
            }

            this.upArrowCheck = null
        }

        const setSelection = (index = null) =&gt; {
            for (let option of this.options) {
                option.removeAttribute(&#x27;selected&#x27;)
            }
            if (index !== null) {
                this.upArrowCheck = this.options[index].value
                this.options[index].setAttribute(&#x27;selected&#x27;, true)
            }
        }

        // this makes new object to avoid having to worry about
        // stuff with the outside set. but it looks at that
        // set every time to make it&#x27;s stuff
        const updateOptions = () =&gt; {
            this.options = []
            for (let option of this.getElementsByTagName(&#x27;option&#x27;)) {
                if (option.text.toLowerCase().includes(this.input.value)) {
                    const optionEl = document.createElement(&#x27;option&#x27;)
                    optionEl.value = option.value
                    optionEl.innerText = option.text
                    this.options.push(optionEl)
                }
            }
        }

        this.wrapper = document.createElement(&#x27;div&#x27;)
        this.wrapper.style.display = &#x27;inline&#x27;

        this.input = document.createElement(&#x27;input&#x27;)
        this.input.setAttribute(&#x27;value&#x27;, &#x27;&#x27;)
        this.input.setAttribute(&#x27;type&#x27;, &#x27;text&#x27;)
        this.input.setAttribute(&#x27;placeholder&#x27;, this.placeholder)
        this.input.addEventListener(&#x27;focus&#x27;, handleInputFocus)
        this.input.addEventListener(&#x27;keyup&#x27;, handleInputKeyup)
        this.input.addEventListener(&#x27;keydown&#x27;, handleInputKeydown)
        this.input.setAttribute(&#x27;autocorrect&#x27;, false)
        this.input.setAttribute(&#x27;spellcheck&#x27;, false)

        this.wrapper.appendChild(this.input)
        this.shadowRoot.append(this.wrapper)

        document.addEventListener(&#x27;mousedown&#x27;, handleDocumentClick)
    }
}

customElements.define(&#x27;enforced-selector&#x27;, EnforcedSelector)
</code></pre>
            
       
                <h2>Notes</h2>
                <ul>
                    <li>Remove the previous 'Search' and 'Autocomplete' tests when this is running</li> <li>The reason for removing and adding the 'select' element (instead of just the options) is because of a behavior in safari where it doesn't respect resetting the position of the selected element on arrow movements</li> <li>I remove the placeholder text when you first click into the input field because it aways throws me when the text stays there on default forms</li>
                </ul>
            
      <h2>Functionality</h2>
      <h3>When neither INPUT or MENU is focused</h3>
      <ul>
        <li>[.] - The INPUT is visible - The MENU is closed and invisible</li>
        <li>
          [.] - The default PLACEHOLDER is show if no prior SELECTION has been
          made
        </li>
        <li>
          [.] - If a previous SELECTION has been made, it is shown as the
          PLACEHOLDER
        </li>
      </ul>

      <h3>When The Input Is Focused</h3>
      <ul>
        <li>[.] - The PLACEHOLDER is removed</li>
        <li>[.] - The MENU opens</li>
        <li>[.] - The Menu shows the default options with none selected</li>
        <li>
          [.] - Hitting ESCAPE in INPUT when INPUT is empty
          <ul>
            <li>[.] - Hides the MENU</li>
            <li>
              [.] - Displays the default PLACEHOLDER if no previos SELECTION has
              been made
            </li>
            <li>
              [.] - Displays the previous SELECTION as the PLACEHOLDER if one
              exists
            </li>
            <li>[.] - Blurs the INPUT</li>
          </ul>
        </li>
        <li>
          [.] - Hitting TAB in INPUT when INPUT is empty
          <ul>
            <li>[.] - Focuses the MENU</li>
            <li>[.] - Selects the first OPTION</li>
          </ul>
        </li>
        <li>[.] - Hitting TAB in INPUT when INPUT has TEXT</li>
        <ul>
          <li>[.] - Focuses the MENU</li>
          <li>
            [.] - No adjustement to SELECTION since it will already be on the
            first OPTION
          </li>
        </ul>
      </ul>

      <h3>[] - Hitting TAB when MENU has focus</h3>
      <ul>
        <li>[ ] - Moves to next TAB INDEX</li>
        <li>[ ] - Closes MENU</li>
        <li>[ ] - Removes any VALUE from INPUT</li>
        <li>[ ] - Displays previous SELECTION as PLACEHOLDER if one exists</li>
        <li>
          [ ] - Displays default PLACEHOLDER if no previous SELECTION exists
        </li>
      </ul>

      <ul>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
        <li>[ ] -</li>
      </ul>

      
                <h2>TODO</h2>
                <ul>
                    <li>[.] - Don't load the options in at the start. call them dynamically so they can be updated outside the component. May have to keep some type of loader in there for the dom ready to prevent issue where the data doesn't show up on first hitting the open element</li> <li>[.] - Load data from child &lt;option&gt; elements</li> <li>[.] - Clicking in the input field opens the menu</li> <li>[.] - Clicking outside the input field closes the menu</li> <li>[.] - Clicking outside the menu closes the menu</li> <li>[ ] - Investigate making this a custom built-in form form element so it can have that API</li> <li>[ ] - Verify that options can be updated live outside the component</li> <li>[.] - Hitting escape while inside resets the form but keeps you in it</li> <li>[ ] - Clicking the up arrow when you're at the top of the list takes up back to the input field</li> <li>[ ] - If you mouse all the way back up, the selection is removed until you hit anoter key</li> <li>[ ] - escape with text removes it. escape without text blurs the input</li> <li>[ ] - If you just arrow down and then immediately up, go back to the input</li> <li>[ ] - Don't try to go past the last item with arrow down</li> <li>[ ] - Investigate UX of moving to alpha sort when a search term is in the Input field</li> <li>[ ] - Add customization that lets you show the default placeholder instead of the prious selection</li>
                </ul>
             
                <h2>References</h2>
                <ul>
                    <li><a href=""></a></li>
                </ul>
                
    </main>
    <footer>
      made by <a href="https://twitter.com/TheIdOfAlan">alan w. smith</a>
      <br />
      who has a <a href="https://www.alanwsmith.com">website</a> and a
      <a href="https://podcast.alanwsmith.com/">podcast</a> <br />
      among other <a href="https://links.alanwsmith.com">things</a>
    </footer>
    <script src="/styles/prism.js"></script>
  </body>
</html>
