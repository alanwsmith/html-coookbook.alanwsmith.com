<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enforced Selection Form Control - The HTML, CSS, and JavaScript Cookbook Of Alan</title>
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Enforced Selection Form Control" />
    <meta property="og:description" content="Goal: a form control that lets you pick from a selection by typing but only from the available selections" />
    <meta
      property="og:image"
      content="https://res.cloudinary.com/awsimages/image/upload/w_1200,h_630/c_fit,co_rgb:222222,l_text:Helvetica_72_bold:Enforced%20Selection%20Form%20Control,w_1080,h_480/fl_layer_apply,g_north_west,x_70,y_70/og-images/html-css-js--og-2022-10-24-blank.png"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site:id" content="@TheIdOfAlan" />
    <meta name="twitter:creator" content="@TheIdOfAlan" />
    <link
      rel="icon"
      type="image/png"
      sizes="228x228"
      href="/favicons/228x228.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="180x180"
      href="/favicons/180x180.png"
    />
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/prism.css" />
    
    <style>
      
    </style>
    <script>
      class EnforcedSelector extends HTMLElement {
    constructor() {
        super()
        this.attachShadow({ mode: 'open' })
        this.defaultOptions = {}
        this.placeholder = 'Select'
        this.options = []

        const log = (msg) => {
            console.log(msg)
        }

        const handleDocumentClick = (event) => {
            if (event.target !== this) {
                this.input.value = ''
                removeMenu()
            }
        }

        const handleInputFocus = () => {
            this.input.setAttribute('placeholder', '')
            renderOptions()
        }

        const handleInputKeydown = (event) => {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === 'tab') {
                event.preventDefault()
                setSelection(0)
                this.select.focus()
            }
        }

        const handleInputKeyup = (event) => {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === 'enter') {
                if (this.input.value !== '') {
                    if (this.options.length > 0) {
                        registerSelection()
                    }
                }
            } else if (keyCheck === 'arrowdown') {
                if (this.input.value === '') {
                    setSelection(0)
                } else {
                    setSelection(1)
                }
                this.select.focus()
            } else if (keyCheck === 'escape') {
                this.input.value = ''
                renderOptions()
            } else {
                renderOptions()
            }
        }

        const handleSelectKeydown = (event) => {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === 'tab') {
                event.preventDefault()
                this.input.focus()
            }
        }

        const handleSelectKeyup = (event) => {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === 'enter') {
                registerSelection()
            }
        }

        const registerSelection = () => {
            for (let option of this.options) {
                if (this.select.value === option.value) {
                    this.placeholder = option.text
                    this.input.setAttribute('placeholder', this.placeholder)
                    this.input.value = ''
                    this.input.blur()
                    removeMenu()
                    break
                }
            }
        }

        const removeMenu = () => {
            if (this.select) {
                while (this.select.firstChild) {
                    this.select.firstChild.remove()
                }
                this.select.blur()
                this.select.remove()
                this.select = null
            }
        }

        const renderOptions = () => {
            if (this.select) {
                while (this.select.firstChild) {
                    this.select.firstChild.remove()
                }
                this.select.blur()
                this.select.remove()
                this.select = null
            }

            updateOptions()

            this.select = document.createElement('select')
            this.select.addEventListener('keydown', handleSelectKeydown)
            this.select.addEventListener('keyup', handleSelectKeyup)
            this.select.size = 5

            for (let option of this.options) {
                this.select.appendChild(option)
            }

            this.wrapper.appendChild(this.select)

            if (this.input.value !== '' && this.options.length > 0) {
                setSelection(0)
            }
        }

        const setSelection = (index = null) => {
            for (let option of this.options) {
                option.removeAttribute('selected')
            }
            if (index !== null) {
                this.options[index].setAttribute('selected', true)
            }
        }

        // this makes new object to avoid having to worry about
        // stuff with the outside set. but it looks at that
        // set every time to make it's stuff
        const updateOptions = () => {
            this.options = []
            for (let option of this.getElementsByTagName('option')) {
                if (option.text.toLowerCase().includes(this.input.value)) {
                    const optionEl = document.createElement('option')
                    optionEl.value = option.value
                    optionEl.innerText = option.text
                    this.options.push(optionEl)
                }
            }
        }

        this.wrapper = document.createElement('div')
        this.wrapper.style.display = 'inline'

        this.input = document.createElement('input')
        this.input.setAttribute('value', '')
        this.input.setAttribute('type', 'text')
        this.input.setAttribute('placeholder', this.placeholder)
        this.input.addEventListener('focus', handleInputFocus)
        this.input.addEventListener('keyup', handleInputKeyup)
        this.input.addEventListener('keydown', handleInputKeydown)
        this.input.setAttribute('autocorrect', false)
        this.input.setAttribute('spellcheck', false)

        this.wrapper.appendChild(this.input)
        this.shadowRoot.append(this.wrapper)

        document.addEventListener('mousedown', handleDocumentClick)
    }
}

customElements.define('enforced-selector', EnforcedSelector)

    </script>
  </head>
  <body class="line-numbers">
    <header>
      <a href="/">Cookbook Home</a> ~
      <a href="https://www.alanwsmith.com/">alanwsmith.com</a> ~
      <a href="https://links.alanwsmith.com">links</a> ~
      <a href="https://podcast.alanwsmith.com/">podcast</a> ~
      <a href="https://https://twitter.com/TheIdOfAlan">twitter</a>
    </header>
    <main>
      <h1>Enforced Selection Form Control</h1>
      <h2>Example</h2>
      <enforced-selector>
  <option value="roboto">Roboto</option>
  <option value="opensans">Open Sans</option>
  <option value="notosansjp">Noto Sans JP</option>
  <option value="montserrat">Montserrat</option>
  <option value="lato">Lato</option>
  <option value="poppins">Poppins</option>
  <option value="sourcesanspro">Source Sans Pro</option>
</enforced-selector>
  
            <h2>HTML</h2>
            <pre><code class="language-html">&lt;enforced-selector&gt;
  &lt;option value=&quot;roboto&quot;&gt;Roboto&lt;/option&gt;
  &lt;option value=&quot;opensans&quot;&gt;Open Sans&lt;/option&gt;
  &lt;option value=&quot;notosansjp&quot;&gt;Noto Sans JP&lt;/option&gt;
  &lt;option value=&quot;montserrat&quot;&gt;Montserrat&lt;/option&gt;
  &lt;option value=&quot;lato&quot;&gt;Lato&lt;/option&gt;
  &lt;option value=&quot;poppins&quot;&gt;Poppins&lt;/option&gt;
  &lt;option value=&quot;sourcesanspro&quot;&gt;Source Sans Pro&lt;/option&gt;
&lt;/enforced-selector&gt;
</code></pre>
              
            <h2>JavaScript</h2>
            <pre><code class="language-js">class EnforcedSelector extends HTMLElement {
    constructor() {
        super()
        this.attachShadow({ mode: &#x27;open&#x27; })
        this.defaultOptions = {}
        this.placeholder = &#x27;Select&#x27;
        this.options = []

        const log = (msg) =&gt; {
            console.log(msg)
        }

        const handleDocumentClick = (event) =&gt; {
            if (event.target !== this) {
                this.input.value = &#x27;&#x27;
                removeMenu()
            }
        }

        const handleInputFocus = () =&gt; {
            this.input.setAttribute(&#x27;placeholder&#x27;, &#x27;&#x27;)
            renderOptions()
        }

        const handleInputKeydown = (event) =&gt; {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === &#x27;tab&#x27;) {
                event.preventDefault()
                setSelection(0)
                this.select.focus()
            }
        }

        const handleInputKeyup = (event) =&gt; {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === &#x27;enter&#x27;) {
                if (this.input.value !== &#x27;&#x27;) {
                    if (this.options.length &gt; 0) {
                        registerSelection()
                    }
                }
            } else if (keyCheck === &#x27;arrowdown&#x27;) {
                if (this.input.value === &#x27;&#x27;) {
                    setSelection(0)
                } else {
                    setSelection(1)
                }
                this.select.focus()
            } else if (keyCheck === &#x27;escape&#x27;) {
                this.input.value = &#x27;&#x27;
                renderOptions()
            } else {
                renderOptions()
            }
        }

        const handleSelectKeydown = (event) =&gt; {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === &#x27;tab&#x27;) {
                event.preventDefault()
                this.input.focus()
            }
        }

        const handleSelectKeyup = (event) =&gt; {
            const keyCheck = event.key.toLowerCase()
            if (keyCheck === &#x27;enter&#x27;) {
                registerSelection()
            }
        }

        const registerSelection = () =&gt; {
            for (let option of this.options) {
                if (this.select.value === option.value) {
                    this.placeholder = option.text
                    this.input.setAttribute(&#x27;placeholder&#x27;, this.placeholder)
                    this.input.value = &#x27;&#x27;
                    this.input.blur()
                    removeMenu()
                    break
                }
            }
        }

        const removeMenu = () =&gt; {
            if (this.select) {
                while (this.select.firstChild) {
                    this.select.firstChild.remove()
                }
                this.select.blur()
                this.select.remove()
                this.select = null
            }
        }

        const renderOptions = () =&gt; {
            if (this.select) {
                while (this.select.firstChild) {
                    this.select.firstChild.remove()
                }
                this.select.blur()
                this.select.remove()
                this.select = null
            }

            updateOptions()

            this.select = document.createElement(&#x27;select&#x27;)
            this.select.addEventListener(&#x27;keydown&#x27;, handleSelectKeydown)
            this.select.addEventListener(&#x27;keyup&#x27;, handleSelectKeyup)
            this.select.size = 5

            for (let option of this.options) {
                this.select.appendChild(option)
            }

            this.wrapper.appendChild(this.select)

            if (this.input.value !== &#x27;&#x27; &amp;&amp; this.options.length &gt; 0) {
                setSelection(0)
            }
        }

        const setSelection = (index = null) =&gt; {
            for (let option of this.options) {
                option.removeAttribute(&#x27;selected&#x27;)
            }
            if (index !== null) {
                this.options[index].setAttribute(&#x27;selected&#x27;, true)
            }
        }

        // this makes new object to avoid having to worry about
        // stuff with the outside set. but it looks at that
        // set every time to make it&#x27;s stuff
        const updateOptions = () =&gt; {
            this.options = []
            for (let option of this.getElementsByTagName(&#x27;option&#x27;)) {
                if (option.text.toLowerCase().includes(this.input.value)) {
                    const optionEl = document.createElement(&#x27;option&#x27;)
                    optionEl.value = option.value
                    optionEl.innerText = option.text
                    this.options.push(optionEl)
                }
            }
        }

        this.wrapper = document.createElement(&#x27;div&#x27;)
        this.wrapper.style.display = &#x27;inline&#x27;

        this.input = document.createElement(&#x27;input&#x27;)
        this.input.setAttribute(&#x27;value&#x27;, &#x27;&#x27;)
        this.input.setAttribute(&#x27;type&#x27;, &#x27;text&#x27;)
        this.input.setAttribute(&#x27;placeholder&#x27;, this.placeholder)
        this.input.addEventListener(&#x27;focus&#x27;, handleInputFocus)
        this.input.addEventListener(&#x27;keyup&#x27;, handleInputKeyup)
        this.input.addEventListener(&#x27;keydown&#x27;, handleInputKeydown)
        this.input.setAttribute(&#x27;autocorrect&#x27;, false)
        this.input.setAttribute(&#x27;spellcheck&#x27;, false)

        this.wrapper.appendChild(this.input)
        this.shadowRoot.append(this.wrapper)

        document.addEventListener(&#x27;mousedown&#x27;, handleDocumentClick)
    }
}

customElements.define(&#x27;enforced-selector&#x27;, EnforcedSelector)
</code></pre>
            
       
                <h2>Notes</h2>
                <ul>
                    <li>Remove the previous 'Search' and 'Autocomplete' tests when this is running</li> <li>The reason for removing and adding the 'select' element (instead of just the options) is because of a behavior in safari where it doesn't respect resetting the position of the selected element on arrow movements</li> <li>I remove the placeholder text when you first click into the input field because it aways throws me when the text stays there on default forms</li>
                </ul>
             
                <h2>TODO</h2>
                <ul>
                    <li>[ ] - Don't load the options in at the start. call them dynamically so they can be updated outside the component. May have to keep some type of loader in there for the dom ready to prevent issue where the data doesn't show up on first hitting the open element</li> <li>[ ] - Load data from child &lt;option&gt; elements</li> <li>[ ] - Clicking in opens the selection</li> <li>[ ] - Clicking out closes the selection</li> <li>[ ] - See if you make this off a selection if it can be use in forms directly</li> <li>[ ] - Verify that options can be updated live outside the component</li> <li>[.] - Hitting escape resets the form but keeps you in it</li>
                </ul>
             
                <h2>References</h2>
                <ul>
                    <li><a href=""></a></li>
                </ul>
                
    </main>
    <footer>
      made by <a href="https://twitter.com/TheIdOfAlan">alan w. smith</a>
      <br />
      who has a <a href="https://www.alanwsmith.com">website</a> and a
      <a href="https://podcast.alanwsmith.com/">podcast</a> <br />
      among other <a href="https://links.alanwsmith.com">things</a>
    </footer>
    <script src="/styles/prism.js"></script>
  </body>
</html>
